!function(){function r(t){for(var e=0,a=["<=",">=","!=","=",">","<"],n=0;n<t.length;n++)if("("===t[n]&&e++,")"===t[n]&&e--,!(0<e))for(var r of a)if(t.substring(n,n+r.length)===r)return{operand:r,left:t.substring(0,n).trim(),right:t.substring(n+r.length).trim()};return{operand:"=",left:t.trim(),right:"true"}}function i(t,e){return"true"===(t=g(t,e,!1))||"false"!==t&&(""===t?"":(e=p.evalFx(""+t,!1),isNaN(e)?t:e))}function f(t,e,a,n){switch(t=i(t,n),e=i(e,n),a){case"<":return t<e;case">":return e<t;case">=":return e<=t;case"<=":return t<=e;case"!=":return t!==e;default:return t===e}}var c=".wapf-",p=WAPF.Util,g=p.parseFx,t=WAPF.Util.formulas;["abs","floor","ceil","sqrt","sin","cos","tan"].forEach(function(a){t[a]=function(t,e){return Math[a](g(t[0],e))}}),t.formatNumber=function(t,e){var a=wapf_config.display_options,e=g(t[0],e);return p.formatNumber(e,1<t.length?t[1]:a.decimals,a.thousand,a.decimal,a.trim_zeroes)},t.round=function(t,e){var a=g(t[0],e);if(t[1]){e=g(t[1],e);return Math.round(a*Math.pow(10,e))/Math.pow(10,e)}return Math.round(a)},t.pow=function(t,e){return Math.pow(g(t[0],e),g(t[1],e))},t.checked=function(t,e){t=e.find(".input-"+t[0]),t=p.getFieldValue(t,!0);return Array.isArray(t)?t.length:0},t.files=function(t,e){t=e.find(".input-"+t[0]);if(1!==t.length)return 0;t=p.getFieldValue(t,!0);return t?t.split(",").length:0},t.sumQty=function(t,e){var e=e.find(".field-"+g(t[0],e,!1)+" .wapf-input"),a=0;return e.each(function(){a+=Number(jQuery(this).val())}),a},t.if=function(t,e){var a=r(t[0]);return f(a.left,a.right,a.operand,e)?t[1]:t[2]},t.or=function(t,e){for(var a=0;a<t.length;a++){var n=r(t[a]);if(f(n.left,n.right,n.operand,e))return"true"}return"false"},t.and=function(t,e){for(var a=0;a<t.length;a++){var n=r(t[a]);if(!f(n.left,n.right,n.operand,e))return"false"}return"true"};var n=wapf_config.date_format;function u(t,e,a){e=t[a||0]?g(t[a||0],e,!1):"";return!!e&&dpParseDate(e,n)}t.datediff=function(t,e){var a=u(t,e),e=u(t,e,1);return a&&e?Math.round((e.getTime()-a.getTime())/864e5):0},t.today=function(){return dpFormatDate(new Date(wapf_config.today),n)},t.dow=function(t,e){e=u(t,e);return e?e.getDay():0};function d(t,e,a){var n="string"==typeof t?t.split(/-/g):t,r=parseInt(n[0])-1,i=parseInt(n[1]),t=e||(2===n.length?(new Date).getFullYear():parseInt(n[2]));return a||1!=r||29!==i||e%4==0&&(e%100!=0||e%400==0)?((n=new Date(new Date(t,parseInt(n[0])-1,parseInt(n[1])).getTime())).setHours(0,0,0,0),n):null}function o(t,e){if(!e)return t;var a=0,n=0,r=0,i=e.split(" ");if(i.length)for(var f=0;f<i.length;f++){var u=i[f].toLowerCase();-1<u.indexOf("y")&&(a+=parseInt(u.replace("y",""))),-1<u.indexOf("m")&&(n+=parseInt(u.replace("m",""))),-1<u.indexOf("d")&&(r+=parseInt(u.replace("d","")))}return function(t,e,a,n){t=new Date(t.getTime());return t.setFullYear(t.getFullYear()+n),t.setMonth(t.getMonth()+a),t.setDate(t.getDate()+e),t}(t,r,n,a)}function l(t,e,a){var n,r=e.field.data(t),i=null;return r&&(h[t][a]?i=h[t][a]:new RegExp("[0-9]{2}-[0-9]{2}([0-9]{4})?").test(r)?(i=d(r),h[t][a]=i):0===r.indexOf("[field")?(n=/field.(.+?)\]/.exec(r))&&(!(n=e.field.closest(".wapf").find(".input-"+n[1]))||(n=p.getFieldValue(n,!0))&&(i=o(dpParseDate(n,wapf_config.date_format),r.replace(/\[(.+)\]/,"").trim()))):(i=o(e.today,r),h[t][a]=i)),i}var s={},h={min:{},max:{}};WAPF.Filter.add("date/selectable",function(t,e){if(!t)return!t;var a=e.field.data("fieldId");if(e.field.data("disable-after")&&e.isToday){var n=e.field.data("disable-after").split(":"),r=new Date((new Date).getTime()+(1e3*e.offset+6e4*(new Date).getTimezoneOffset()));if(r.getHours()>=parseInt(n[0])&&r.getMinutes()>=parseInt(n[1]))return!1}if(void 0!==e.field.data("disabled-days")&&-1<(f=(""+e.field.data("disabled-days")).split(",").map(function(t){return parseInt(t)})).indexOf(e.date.getDay()))return!1;n=l("min",e,a);if(n&&e.date<n)return!1;if((n=l("max",e,a))&&e.date>n)return!1;if(e.field.data("disabled-dates")){s[a]||(s[a]=[],e.field.data("disabled-dates").split(",").map(function(t){return t.trim()}).forEach(function(t){var e;-1<t.indexOf(" ")?(e=t.split(" "),s[a].push({start:e[0].split(/-/g),end:e[1].split(/-/g)})):s[a].push({start:t.split(/-/g)})}));for(var i=0;i<s[a].length;i++){var f,u=s[a][i];if(f=d(u.start,2===u.start.length?e.date.getFullYear():null,u.end))if(u.end){u=d(u.end,2===u.end.length?e.date.getFullYear():null,!0);if(u&&e.date>=f&&e.date<=u)return!1}else if(e.date.getMonth()===f.getMonth()&&e.date.getFullYear()===f.getFullYear()&&e.date.getDate()===f.getDate())return!1}}return t}),jQuery(document).on("wapf/init",function(t,l){var e,a=l.find(c+"field-calc"),s=l.data("$totals").data("tax")||1;a.length&&(jQuery(document).on("wapf/cloned wapf/uncloned",function(){a=l.find(c+"field-calc")}),jQuery(document).on("wapf/cloned",function(t,e,n,a,r){a.find(c+"calc-text").each(function(t,e){var a=jQuery(e);"default"===a.data("type")&&(e=p.cloneFx(a.data("formula"),r,n),a.attr("data-formula",e).data("formula",e))})}),e=function(){a.each(function(t,e){var a,n,r,i,f,u,d,o=jQuery(e);o.hasClass("wapf-hide")||(a=o.find(c+"calc-text"),n=o.find("input"),d=0,"cost"===a.data("type")?d=p.formatMoney(WAPF.Filter.apply("wapf/fx/hint",n.data("price")*s),wapf_config.display_options):(r=wapf_config.display_options,i=a.data("format"),f=p.getQty(l),u=p.currentProductPrice(l),e=p.replaceFx(a.data("formula"),f,u,0,l,l.data("optionsTotal")||0),e=p.evalVars(WAPF.Pricing.variables,e,0,f,u,o,l,l.data("optionsTotal")||0),d=g(e,l,!1,o),"number"===i&&(d=p.evalFx(d),d=p.formatNumber(d,r.decimals,r.thousand,r.decimal,r.trim_zeroes))),d=a.data("txt").replace(/\{result}/g,d),a.html(d),n.val(d))})},l.on("keyup change",'.wapf-input, input[name="variation_id"]',e),l.data("$qty").on("change",e),e()),l.on("input",".wapf-checkbox.wapf-custom-qty",function(t){var e=jQuery(t.target),a=e.closest(".wapf-custom-qty"),n=a.find('input[type="number"]'),t=parseInt(n.val())||0;"number"===e.attr("type")?a.find('input[type="checkbox"]').prop("checked",0<t).trigger("change"):e.is(":checked")&&!t?n.val(1).trigger("change"):e.is(":checked")||n.val(0).trigger("change")})})}();